defmodule Mcp.Repo.Migrations.CreateMissingLookupTables do
  use Ecto.Migration

  def up do
    # Create lookup tables that are needed by the polymorphic entities migration
    # These tables should have been created before the polymorphic entities

    # Entity Types
    create table(:entity_types, primary_key: false, prefix: "platform") do
      add :value, :text, primary_key: true
      add :label, :text, null: false
      add :description, :text
      add :is_active, :boolean, default: true
      add :sort_order, :integer, default: 0

      add :created_at, :utc_datetime, null: false, default: fragment("NOW()")
    end

    # Insert basic entity types
    execute """
    INSERT INTO platform.entity_types (value, label, description, sort_order)
    VALUES
      ('platform', 'Platform', 'Platform-level entity', 1),
      ('tenant', 'Tenant', 'Tenant-level entity', 2),
      ('developer', 'Developer', 'Developer entity', 3),
      ('reseller', 'Reseller', 'Reseller entity', 4),
      ('merchant', 'Merchant', 'Merchant entity', 5),
      ('store', 'Store', 'Store entity', 6),
      ('user', 'User', 'User entity', 7)
    """, nil

    # Image Types
    create table(:image_types, primary_key: false, prefix: "platform") do
      add :value, :text, primary_key: true
      add :label, :text, null: false
      add :description, :text
      add :is_active, :boolean, default: true
      add :sort_order, :integer, default: 0

      add :created_at, :utc_datetime, null: false, default: fragment("NOW()")
    end

    # Insert basic image types
    execute """
    INSERT INTO platform.image_types (value, label, description, sort_order)
    VALUES
      ('profile', 'Profile Picture', 'User profile picture', 1),
      ('logo', 'Logo', 'Company or brand logo', 2),
      ('banner', 'Banner', 'Banner or header image', 3),
      ('product', 'Product', 'Product image', 4),
      ('document', 'Document', 'Document scan or screenshot', 5)
    """, nil

    # Document Types
    create table(:document_types, primary_key: false, prefix: "platform") do
      add :value, :text, primary_key: true
      add :label, :text, null: false
      add :description, :text
      add :is_active, :boolean, default: true
      add :sort_order, :integer, default: 0

      add :created_at, :utc_datetime, null: false, default: fragment("NOW()")
    end

    # Insert basic document types
    execute """
    INSERT INTO platform.document_types (value, label, description, sort_order)
    VALUES
      ('contract', 'Contract', 'Legal contract or agreement', 1),
      ('invoice', 'Invoice', 'Invoice or bill', 2),
      ('receipt', 'Receipt', 'Proof of purchase', 3),
      ('identification', 'Identification', 'ID document (passport, driver license)', 4),
      ('certificate', 'Certificate', 'Certificate or credential', 5),
      ('other', 'Other', 'Other document type', 99)
    """, nil

    # Social Platforms
    create table(:social_platforms, primary_key: false, prefix: "platform") do
      add :value, :text, primary_key: true
      add :label, :text, null: false
      add :description, :text
      add :is_active, :boolean, default: true
      add :sort_order, :integer, default: 0

      add :created_at, :utc_datetime, null: false, default: fragment("NOW()")
    end

    # Insert social platforms
    execute """
    INSERT INTO platform.social_platforms (value, label, description, sort_order)
    VALUES
      ('twitter', 'Twitter', 'Twitter/X social media platform', 1),
      ('linkedin', 'LinkedIn', 'LinkedIn professional network', 2),
      ('facebook', 'Facebook', 'Facebook social media platform', 3),
      ('instagram', 'Instagram', 'Instagram photo sharing platform', 4),
      ('github', 'GitHub', 'GitHub code repository platform', 5),
      ('website', 'Website', 'Personal or company website', 6),
      ('other', 'Other', 'Other social platform', 99)
    """, nil

    # Status Types
    create table(:status_types, primary_key: false, prefix: "platform") do
      add :value, :text, primary_key: true
      add :label, :text, null: false
      add :description, :text
      add :is_active, :boolean, default: true
      add :sort_order, :integer, default: 0

      add :created_at, :utc_datetime, null: false, default: fragment("NOW()")
    end

    # Insert status types
    execute """
    INSERT INTO platform.status_types (value, label, description, sort_order)
    VALUES
      ('pending', 'Pending', 'Pending status', 1),
      ('in_progress', 'In Progress', 'Work in progress', 2),
      ('completed', 'Completed', 'Successfully completed', 3),
      ('cancelled', 'Cancelled', 'Cancelled or aborted', 4),
      ('on_hold', 'On Hold', 'Temporarily on hold', 5),
      ('rejected', 'Rejected', 'Rejected or denied', 6)
    """, nil
  end

  def down do
    drop table(:status_types, prefix: "platform")
    drop table(:social_platforms, prefix: "platform")
    drop table(:document_types, prefix: "platform")
    drop table(:image_types, prefix: "platform")
    drop table(:entity_types, prefix: "platform")
  end
end